<link href="Libs/jquery-ui-1.11.4/jquery-ui.css" rel="stylesheet">
<script src="Libs/jquery/jquery-1.12.3.min.js"></script>
<link rel="stylesheet" href="Libs/bootstrap/css/bootstrap.min.css">
<script src="Libs/bootstrap/js/bootstrap.min.js"></script>
<script src="Libs/jquery-ui-1.11.4/jquery-ui.js"></script>
<script src="Libs/underscore.js"></script>
<script src="Libs/expression.js"></script>
<script src="Libs/math.min.js"></script>
<script type="text/javascript">
	window.onload = function() {
	var dps =[]; // dataPoints
	dps[0] = [];
	dps[1] = [];
	dps[2] = [];
	dps[3] = [];
	var xValue = parent.GraphInfo[parent.tabIndex].X;
	console.log(xValue);
	console.log(parent.GraphInfo);
	if( xValue==-1){
		for (var i=0; i<parent.totalValueRow; i++) {
			if(parent.GraphInfo[parent.tabIndex].Y1!= -1)
			{
				dps[0].push({
					x : parent.recordId[i],
					y : parent.matrix[parent.GraphInfo[parent.tabIndex].Y1][i]
				})
			}
			if(parent.GraphInfo[parent.tabIndex].Y2!= -1)
			{
				dps[1].push({
					x : parent.recordId[i],
					y : parent.matrix[parent.GraphInfo[parent.tabIndex].Y2][i]})
			}
			if(parent.GraphInfo[parent.tabIndex].Y3!= -1)
			{
				dps[2].push({
					x : parent.recordId[i],
					y : parent.matrix[parent.GraphInfo[parent.tabIndex].Y3][i]})
			}
			if(parent.GraphInfo[parent.tabIndex].valueCompare.length!=0){
				dps[3].push({
					x : parent.recordId[i],
					y : parent.GraphInfo[parent.tabIndex].valueCompare[i]})
			}
		}
	}
	else
	{
		for (var i=0; i<parent.totalValueRow; i++) {
			if(parent.GraphInfo[parent.tabIndex].Y1!= -1)
			{
				dps[0].push({
					x : parent.matrix[xValue][i],
					y : parent.matrix[parent.GraphInfo[parent.tabIndex].Y1][i]
				})
			}
			if(parent.GraphInfo[parent.tabIndex].Y2!= -1)
			{
				dps[1].push({
					x : parent.matrix[xValue][i],
					y : parent.matrix[parent.GraphInfo[parent.tabIndex].Y2][i]})
			}
			if(parent.GraphInfo[parent.tabIndex].Y3!= -1)
			{
				dps[2].push({
					x : parent.matrix[xValue][i],
					y : parent.matrix[parent.GraphInfo[parent.tabIndex].Y3][i]})
			}
			if(parent.GraphInfo[parent.tabIndex].valueCompare.length > 0){
				dps[3].push({
					x : parent.matrix[xValue][i],
					y : parent.GraphInfo[parent.tabIndex].valueCompare[i]})
			}
		}
	}
	dps[0]= _.sortBy(dps[0], 'x');
	dps[1]= _.sortBy(dps[1], 'x');
	dps[2]= _.sortBy(dps[2], 'x');
	var nameOfX;
	var nameOfY =[];
	var valueOfshowInLegend =[];
	if(xValue == -1)
		nameOfX = "Time"
	else
		nameOfX = parent.tableLable[xValue]
	if(parent.GraphInfo[parent.tabIndex].Y1!=-1)
	{
		nameOfY.push(parent.tableLable[parent.GraphInfo[parent.tabIndex].Y1])
		valueOfshowInLegend.push(true)
	}
	else
	{
		nameOfY.push("DoNotSet")
		valueOfshowInLegend.push(false)
	}
	if(parent.GraphInfo[parent.tabIndex].Y2!=-1)
	{
		nameOfY.push(parent.tableLable[parent.GraphInfo[parent.tabIndex].Y2])
		valueOfshowInLegend.push(true)
	}
	else
	{
		nameOfY.push("DoNotSet")
		valueOfshowInLegend.push(false)
	}
    if(parent.GraphInfo[parent.tabIndex].Y3!=-1)
	{
		nameOfY.push(parent.tableLable[parent.GraphInfo[parent.tabIndex].Y3])
		valueOfshowInLegend.push(true)
	}
	else
	{
		nameOfY.push("DoNotSet")
		valueOfshowInLegend.push(false)
	}
	if(parent.GraphInfo[parent.tabIndex].valueCompare.length > 0){
		nameOfY.push("CompareValue")
		valueOfshowInLegend.push(true)
	}
	else
	{
		nameOfY.push("DoNotSet")
		valueOfshowInLegend.push(false)
	}
	var chart = new CanvasJS.Chart("chartContainer2", {
		title : {
			text : parent.nameOfGraph.value
		},
		exportEnabled: true,
		zoomEnabled: true, 
		includeZero: false,
		axisY:{
	        // interlacedColor: "#FFBFD5",
	        title: nameOfX,
	        gridColor: "#f5f5f0",
	        lineColor: "#0f0f0a",
	        tickColor: "#0f0f0a",
	        labelFontColor:"#0f0f0a",
	    },
	    axisX:{
	        // interlacedColor: "#FFBFD5",
	        lineColor: "#0f0f0a",
	        tickColor: "#0f0f0a",
	        labelFontColor:"#0f0f0a",
	    },
	    dataSeries:{
		   cursor: "pointer"  
		 },
		 legend: {
            cursor: "pointer",
            fontSize: 22,
            itemclick: function (e) {
                //console.log("legend click: " + e.dataPointIndex);
                //console.log(e);
                if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                    e.dataSeries.visible = false;
                } else {
                    e.dataSeries.visible = true;
                }

                e.chart.render();
            }
        },
	    data : [ {
	    	legendText :  nameOfY[0],
	    	showInLegend: valueOfshowInLegend[0],
	    	type : "line",
	    	color: parent.colorForY1.value,
	    	dataPoints : dps[0]
	    }, {
	    	legendText :   nameOfY[1],
	    	showInLegend: valueOfshowInLegend[1],
	    	type : "line",
	    	color: parent.colorForY2.value,
	    	dataPoints : dps[1]
	    },
	    {
	    	legendText :   nameOfY[2],
	    	showInLegend: valueOfshowInLegend[2],
	    	type : "line",
	    	color: parent.colorForY3.value,
	    	dataPoints : dps[2]
	    }, 
	    	    {
	    	legendText :   nameOfY[3],
	    	showInLegend: valueOfshowInLegend[3],
	    	type : "line",
	    	dataPoints : dps[3]
	    },
	    ]
	});
	console.log( parent.colorForY1.value);
	console.log( parent.colorForY2.value);
	console.log( parent.colorForY3.value);
	chart.render();
}
</script>
<script type="text/javascript" src="Libs/canvasjs-1.8.0/canvasjs.min.js"></script>
<div id="chartContainer2" style="height: 400px; width: 100%;"></div>
<button class="btn btn-success" style="height:30px; width:100px"  onclick="openCompareForm()">Compare</button><br>
<div id="compareShow"  style="height: 100px; width: 100%;">
<label id="labelForFuntionCompare"> Func:</label>
<input id="InfoFuntionCompare" value="None" class="displayValueForGraph" disabled="true"></input>
<div id="constantCompare"></div>
</div>
<div id="compareDialog">
  <form>
    <p>
      <label> Equalition:</label><br>
      <textarea id="NewGraphEqualition" rows="2" cols="60" placeholder="Enter equalition"></textarea>
    </p>
    <br><label> Note:
    <pre>
      - d(x): Derivative of x
      - l(x): Integral of x
      - const(A): Constant name A, 
      which can be changed while drawing
      - operation: + (add), -(sub), *(mul), / (div)
    </pre>
  </label>
</form>
</div>
<script type="text/javascript">
if(parent.GraphInfo[parent.tabIndex].funtionCompare=="")
{
	document.getElementById("labelForFuntionCompare").style.display = "none";
	document.getElementById("InfoFuntionCompare").style.display = "none";
}
else
{
	var contentConstantDisplay = "";
	document.getElementById("labelForFuntionCompare").style.display = "inline";
	document.getElementById("InfoFuntionCompare").style.display = "inline";
	document.getElementById("InfoFuntionCompare").value = parent.GraphInfo[parent.tabIndex].funtionCompare;
	for (var key in parent.GraphInfo[parent.tabIndex].constantCompare) {
      if (parent.GraphInfo[parent.tabIndex].constantCompare.hasOwnProperty(key)) {
        console.log(key);
        console.log(parent.GraphInfo[parent.tabIndex].constantCompare[key]);
        contentConstantDisplay+="<label class=\"labelColumn\">" + key + ": </label>";
        contentConstantDisplay+="<input id=\"X0value"+key+"\" class=\"constantValue\" value=\""+parent.GraphInfo[parent.tabIndex].constantCompare[key] +  "\"></input>";
        contentConstantDisplay+="<input type=\"button\" class=\"increase\" id=\"X0increase" + key + "\" value=\"+\"></input><input type=\"button\" class=\"decrease\" id=\"X0decrease" + key + "\"value=\"-\"></input>";
      }
    }
    document.getElementById("constantCompare").innerHTML = contentConstantDisplay;
}
 function addFunctionCompare()
  {
		listOfSymbol = {}
		listOfConst = {}
		LENGHT = parent.totalValueRow
		parent.tableLable.forEach(function myFunction(item, index) {
			listOfSymbol[item.replace(/\s/g, '')] = parent.matrix[index]
		})


		try{
			var ex = formatExpression(NewGraphEqualition.value)
			console.log(ex)
			console.log(listOfConst)
			newColumnValues = compute(ex)
			console.log(newColumnValues)
			parent.GraphInfo[parent.tabIndex].funtionCompare = NewGraphEqualition.value
			parent.GraphInfo[parent.tabIndex].valueCompare = newColumnValues
			parent.GraphInfo[parent.tabIndex].constantCompare = listOfConst
			document.location.href = document.location.href;

		}
		catch(e){
			console.log(e)
			alert("Syntax error : " + e.message);
		}

  }
  $("#compareDialog").dialog({
    autoOpen: false,
    width: 500,
    height: 450,
    // modal: true,
    title: "Add Function to compare",
    dialogClass: "dlg-no-close",
    position: {
      my: "right",
      at: "center"
    },
    buttons: { 
      Ok: function() {
        addFunctionCompare();
        $(this).dialog("close");
      },
      Cancel: function () {
        $(this).dialog("close");
      }
    }
  });
 
  function openCompareForm()
  {
  	$("#compareDialog").dialog("open");
  }

  </script>
